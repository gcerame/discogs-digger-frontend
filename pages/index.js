import Head from 'next/head';
import {useState} from "react";
import {Button, Input, Grid, Text} from "@nextui-org/react";
import Release from "../components/release";

export default function Home () {
    const [releases, setReleases] = useState([]);
    const [error, setError] = useState(null);

    const handleSubmit = async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);
        //Remove empty items from object
        Object.keys(data).forEach((key) => data[key] === '' && delete data[key]);
        //URL encode the search query
        const searchQuery = new URLSearchParams(data).toString();
        try {
            const APIURL = `http://localhost:3001/search/?${searchQuery}`;
            console.log(APIURL);
            const response = await fetch(APIURL);
            const fetchedReleases = await response.json();
            console.log(fetchedReleases);
            setReleases(fetchedReleases);

        } catch (e) {
            setError(e);
            console.log(e);
        }
    };

    const mapReleasesToComponent = () => {
        return releases.map((release) => {
            return (
                <Release release={release} key={release.id}/>
            );
        });
    };

    return (
        <>
            <Head>
                <title>discogs-digger</title>
                <meta name="description" content="Generated by create next app"/>
            </Head>

            <main>
                <Text h1>
                    Welcome to <Text span css={{
                    textGradient: "45deg, $blue600 -20%, $purple600 50%",
                }}>discogs-digger</Text>
                </Text>
                <form onSubmit={handleSubmit}>
                    <Grid.Container gap={2} justify="center">

                        <Grid><Input placeholder="Style" id="style" name="style" aria-label="style" clearable/></Grid>
                        <Grid><Input placeholder="Year" id="year" name="year" aria-label="year" clearable/></Grid>

                        <Grid><Input placeholder="Label" id="label" name="label" aria-label="label" clearable/></Grid>
                        <Grid><Input placeholder="Country" id="country" name="country" aria-label="country" clearable/></Grid>
                        <Grid><Input placeholder="Artist" id="artist" name="artist" aria-label="artist"
                                     clearable/></Grid>


                    </Grid.Container>
                    <Grid><Button type="submit">Search</Button></Grid>

                </form>
                <Grid.Container gap={5}>
                    <Grid fluid>{mapReleasesToComponent()}</Grid>
                </Grid.Container>
            </main>
        </>
    );
}
